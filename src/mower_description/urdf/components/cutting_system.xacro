<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro">

  <!-- 
    Cutting System Component
    
    This file defines the cutting and support system of the mower:
    - front_roller: Front support roller
    - reel: Main cutting reel assembly
    - reel_motor: Motor that drives the cutting reel
    
    The cutting system includes both active (reel) and passive (roller) elements.
    Dimensions and masses are based on the Product Requirements Document.
  -->

  <!-- Front Roller -->
  <link name="front_roller">
    <visual>
      <geometry>
        <!-- Front roller dimensions: Ø8.89cm, W:33cm -->
        <cylinder radius="0.04445" length="0.33"/>
      </geometry>
      <material name="green"/>
    </visual>
    
    <collision>
      <geometry>
        <cylinder radius="0.04445" length="0.33"/>
      </geometry>
    </collision>
    
    <inertial>
      <mass value="0.45"/>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <!-- Cylinder inertia: m/12 * [3r²+l², 3r²+l², 6r²] -->
      <!-- r=0.04445, l=0.33 -->
      <!-- Ixx = 0.45/12 * (3*0.04445² + 0.33²) = 0.0375 * (0.00593 + 0.1089) = 0.00431 -->
      <!-- Iyy = 0.45/12 * (3*0.04445² + 0.33²) = 0.0375 * (0.00593 + 0.1089) = 0.00431 -->
      <!-- Izz = 0.45/12 * (6*0.04445²) = 0.0375 * 0.01185 = 0.000444 -->
      <inertia ixx="0.00431" ixy="0.0" ixz="0.0"
               iyy="0.00431" iyz="0.0"
               izz="0.000444"/>
    </inertial>
  </link>

  <!-- Front roller joint -->
  <joint name="front_roller_joint" type="continuous">
    <parent link="base_link"/>
    <child link="front_roller"/>
    <!-- Position: At (48cm, 0, 4.445cm) -->
    <origin xyz="0.48 0.0 0.04445" rpy="-1.5707963 0 0"/>
    <axis xyz="0 0 1"/>
  </joint>

  <!-- Cutting Reel -->
  <link name="reel">
    <visual>
      <geometry>
        <!-- Reel dimensions: Ø17.5cm, W:47cm -->
        <cylinder radius="0.0875" length="0.47"/>
      </geometry>
      <material name="red"/>
    </visual>
    
    <collision>
      <geometry>
        <cylinder radius="0.0875" length="0.47"/>
      </geometry>
    </collision>
    
    <inertial>
      <mass value="11.34"/>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <!-- Cylinder inertia: m/12 * [3r²+l², 3r²+l², 6r²] -->
      <!-- r=0.0875, l=0.47 -->
      <!-- Ixx = 11.34/12 * (3*0.0875² + 0.47²) = 0.945 * (0.0229 + 0.2209) = 0.230 -->
      <!-- Iyy = 11.34/12 * (3*0.0875² + 0.47²) = 0.945 * (0.0229 + 0.2209) = 0.230 -->
      <!-- Izz = 11.34/12 * (6*0.0875²) = 0.945 * 0.0459 = 0.0434 -->
      <inertia ixx="0.230" ixy="0.0" ixz="0.0"
               iyy="0.230" iyz="0.0"
               izz="0.0434"/>
    </inertial>
  </link>

  <!-- Reel joint -->
  <joint name="reel_joint" type="continuous">
    <parent link="base_link"/>
    <child link="reel"/>
    <!-- Position: Raise reel 3cm off ground
         Reel radius is 8.75cm, so center should be at 3 + 8.75 = 11.75cm -->
    <origin xyz="0.30 0.0 0.1175" rpy="-1.5707963 0 0"/>
    <axis xyz="0 0 1"/>
  </joint>

  <!-- Reel Motor -->
  <link name="reel_motor">
    <visual>
      <geometry>
        <!-- Motor dimensions: cylinder with 2cm radius, 12cm height -->
        <cylinder radius="0.02" length="0.12"/>
      </geometry>
      <material name="black"/>
    </visual>
    
    <collision>
      <geometry>
        <cylinder radius="0.02" length="0.12"/>
      </geometry>
    </collision>
    
    <inertial>
      <mass value="1.0"/>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <!-- Cylinder inertia: m/12 * [3r²+l², 3r²+l², 6r²] -->
      <!-- r=0.02, l=0.12 -->
      <!-- Ixx = 1.0/12 * (3*0.02² + 0.12²) = 0.0833 * (0.0012 + 0.0144) = 0.00130 -->
      <!-- Iyy = 1.0/12 * (3*0.02² + 0.12²) = 0.0833 * (0.0012 + 0.0144) = 0.00130 -->
      <!-- Izz = 1.0/12 * (6*0.02²) = 0.0833 * 0.0024 = 0.000200 -->
      <inertia ixx="0.00130" ixy="0.0" ixz="0.0"
               iyy="0.00130" iyz="0.0"
               izz="0.000200"/>
    </inertial>
  </link>

  <!-- Reel motor joint - fixed to chassis -->
  <joint name="reel_motor_joint" type="fixed">
    <parent link="chassis"/>
    <child link="reel_motor"/>
    <!-- Position: At (21.8cm, -23.5cm, 17.55cm) relative to base_link
         Since chassis is now at Z=20.75cm, adjust relative position:
         Z_relative = 17.55 - 20.75 = -3.2cm -->
    <origin xyz="0.218 -0.235 -0.032" rpy="-1.5707963 0 0"/>
  </joint>

</robot>
